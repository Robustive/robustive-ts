var I=(s,c,a)=>{if(!c.has(s))throw TypeError("Cannot "+a)};var o=(s,c,a)=>(I(s,c,"read from private field"),a?a.call(s):c.get(s)),b=(s,c,a)=>{if(c.has(s))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(s):c.set(s,a)},S=(s,c,a,v)=>(I(s,c,"write to private field"),v?v.call(s,a):c.set(s,a),a);(function(s,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(s=typeof globalThis!="undefined"?globalThis:s||self,c(s.Robustive={}))})(this,function(s){var g,d,w,h;"use strict";class c{constructor(t=null){this.user=t}}class a extends c{}const v=i=>i.constructor===a,A=class{constructor(){return new Proxy(this,{get(t,e,n){switch(e){case"basics":case"alternatives":case"goals":return new Proxy({},{get(u,f,r){return typeof f=="string"&&!(f in u)?l=>Object.freeze({scene:f,course:e,...l}):Reflect.get(u,e,r)}});default:return Reflect.get(t,e,n)}}})}},O={success:"success",failure:"failure"},x=class{constructor(){return new Proxy(this,{get(t,e,n){return typeof e=="string"&&!(e in t)?u=>Object.freeze({type:e,...u}):Reflect.get(t,e,n)}})}},C=i=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(i))).map(e=>t[e%t.length]).join("")};class z{constructor(t,e,n,u){b(this,g,void 0);b(this,d,void 0);b(this,w,void 0);b(this,h,void 0);this.id=C(8),S(this,g,t),S(this,d,e),S(this,w,n),S(this,h,u)}interactedBy(t){const e=new Date,n=new x,u=r=>{const l=r.slice(-1)[0];return l.course==="goals"?Promise.resolve(r):o(this,h).next(l).then(y=>(r.push(y),u(r)))};if(o(this,h).authorize&&!o(this,h).authorize(t,o(this,g),o(this,d))){const r=new j(t.constructor.name,o(this,d));return Promise.reject(r)}const f=[o(this,w)];return u(f).then(r=>{const l=new Date,y=l.getTime()-e.getTime(),m=r.slice(-1)[0],T=n.success({id:this.id,actor:t,domain:o(this,g),usecase:o(this,d),startAt:e,endAt:l,elapsedTimeMs:y,performedScenario:r,lastSceneContext:m});return o(this,h).complete&&o(this,h).complete(T),T}).catch(r=>{console.error(r);const l=new Date,y=l.getTime()-e.getTime(),m=n.failure({id:this.id,actor:t,domain:o(this,g),usecase:o(this,d),startAt:e,endAt:l,elapsedTimeMs:y,error:r});return o(this,h).complete&&o(this,h).complete(m),m})}}g=new WeakMap,d=new WeakMap,w=new WeakMap,h=new WeakMap;const R=class{constructor(t,e,n,u){return new Proxy(this,{get(f,r,l){return typeof r=="string"&&!(r in f)?y=>{const m={scene:r,course:n,...y},T=new z(t,e,m,new u);return Object.freeze(Object.assign(T,{name:e,domain:t}))}:Reflect.get(f,r,l)}})}};class U{constructor(){const{basics:t,alternatives:e,goals:n}=new A;this.basics=t,this.alternatives=e,this.goals=n}just(t){return Promise.resolve(t)}}class D{constructor(t,e,n){this.basics=new R(t,e,"basics",n),this.alternatives=new R(t,e,"alternatives",n),this.goals=new R(t,e,"goals",n)}}const P=class{constructor(t){return new Proxy(this,{get(e,n,u){return typeof n=="string"&&!(n in e)?f=>new D(t,n,f):Reflect.get(e,n,u)}})}},N=class{constructor(){return new Proxy(this,{get(t,e,n){return typeof e=="string"&&!(e in t)?new P(e):Reflect.get(t,e,n)}})}};class j extends Error{constructor(t,e){super(`The actor "${t}" is not authorized to interact on usecase "${e}".`),Object.setPrototypeOf(this,new.target.prototype)}}s.ActorNotAuthorizedToInteractIn=j,s.BaseActor=c,s.BaseScenario=U,s.ContextSelector=A,s.InteractResultType=O,s.Nobody=a,s.UsecaseSelector=P,s.UsecaseSelectorOverDomain=N,s.isNobody=v,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
