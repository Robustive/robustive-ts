var j=(s,c,a)=>{if(!c.has(s))throw TypeError("Cannot "+a)};var i=(s,c,a)=>(j(s,c,"read from private field"),a?a.call(s):c.get(s)),b=(s,c,a)=>{if(c.has(s))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(s):c.set(s,a)},R=(s,c,a,S)=>(j(s,c,"write to private field"),S?S.call(s,a):c.set(s,a),a);(function(s,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(s=typeof globalThis!="undefined"?globalThis:s||self,c(s.Robustive={}))})(this,function(s){var f,g,w,h;"use strict";class c{constructor(t=null){this.user=t}}class a extends c{}const S=u=>u.constructor===a,A=class{constructor(){return new Proxy(this,{get(t,e,n){switch(e){case"basics":case"alternatives":case"goals":return new Proxy({},{get(r,d,o){return typeof d=="string"&&!(d in r)?l=>Object.freeze({scene:d,course:e,...l}):Reflect.get(r,e,o)}});default:return Reflect.get(t,e,n)}}})}},x={success:"success",failure:"failure"},C=class{constructor(){return new Proxy(this,{get(t,e,n){return typeof e=="string"&&!(e in t)?r=>Object.freeze({type:e,...r}):Reflect.get(t,e,n)}})}},z=u=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(u))).map(e=>t[e%t.length]).join("")};class N{constructor(t,e,n,r){b(this,f,void 0);b(this,g,void 0);b(this,w,void 0);b(this,h,void 0);this.id=z(8),R(this,f,t),R(this,g,e),R(this,w,n),R(this,h,r)}interactedBy(t){const e=new Date,n=new C,r=o=>{const l=o.slice(-1)[0];return l.course==="goals"?Promise.resolve(o):i(this,h).next(l).then(y=>(o.push(y),r(o)))};if(i(this,h).authorize&&!i(this,h).authorize(t,i(this,f),i(this,g))){const o=new P(t,i(this,f),i(this,g));return Promise.reject(o)}const d=[i(this,w)];return r(d).then(o=>{const l=new Date,y=l.getTime()-e.getTime(),m=o.slice(-1)[0],v=n.success({id:this.id,actor:t,domain:i(this,f),usecase:i(this,g),startAt:e,endAt:l,elapsedTimeMs:y,performedScenario:o,lastSceneContext:m});return i(this,h).complete&&i(this,h).complete(v),v}).catch(o=>{console.error(o);const l=new Date,y=l.getTime()-e.getTime(),m=n.failure({id:this.id,actor:t,domain:i(this,f),usecase:i(this,g),startAt:e,endAt:l,elapsedTimeMs:y,error:o});return i(this,h).complete&&i(this,h).complete(m),m})}}f=new WeakMap,g=new WeakMap,w=new WeakMap,h=new WeakMap;const T=class{constructor(t,e,n,r){return new Proxy(this,{get(d,o,l){return typeof o=="string"&&!(o in d)?y=>{const m={scene:o,course:n,...y},v=new r,M=new N(t,e,m,v);return Object.freeze(Object.assign(M,{name:e,domain:t}))}:Reflect.get(d,o,l)}})}};class B{constructor(){const{basics:t,alternatives:e,goals:n}=new A;this.basics=t,this.alternatives=e,this.goals=n}just(t){return Promise.resolve(t)}}class O{constructor(t,e,n){this.basics=new T(t,e,"basics",n),this.alternatives=new T(t,e,"alternatives",n),this.goals=new T(t,e,"goals",n)}}const I=class{constructor(t,e){return new Proxy(this,{get(n,r,d){return typeof r=="string"&&!(r in n)?new O(t,r,e[r]):Reflect.get(n,r,d)}})}},U=class{constructor(t){return new Proxy(this,{get(e,n,r){return typeof n=="string"&&!(n in e)?new I(n,t[n]):Reflect.get(e,n,r)}})}};class P extends Error{constructor(t,e,n){super(`The actor "${t.constructor.name}" is not authorized to interact on usecase "${String(n)}" of domain "${String(e)}".`)}}s.ActorNotAuthorizedToInteractIn=P,s.BaseActor=c,s.BaseScenario=B,s.ContextSelector=A,s.InteractResultType=x,s.Nobody=a,s.Robustive=U,s.UsecaseSelector=I,s.isNobody=S,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
