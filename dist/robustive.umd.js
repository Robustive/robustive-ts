var P=(n,c,u)=>{if(!c.has(n))throw TypeError("Cannot "+u)};var i=(n,c,u)=>(P(n,c,"read from private field"),u?u.call(n):c.get(n)),S=(n,c,u)=>{if(c.has(n))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(n):c.set(n,u)},R=(n,c,u,T)=>(P(n,c,"write to private field"),T?T.call(n,u):c.set(n,u),u);(function(n,c){typeof exports=="object"&&typeof module!="undefined"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(n=typeof globalThis!="undefined"?globalThis:n||self,c(n.Robustive={}))})(this,function(n){var f,y,w,l;"use strict";class c{constructor(e=null){this.user=e}}class u extends c{}const T=a=>a.constructor===u,v=class{constructor(e){return new Proxy(this,{get(t,s,r){return typeof s=="string"&&!(s in t)?h=>Object.freeze({scene:s,course:e,...h}):Reflect.get(t,s,r)}})}},x={success:"success",failure:"failure"},z=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?r=>Object.freeze({type:t,...r}):Reflect.get(e,t,s)}})}},U=a=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(a))).map(t=>e[t%e.length]).join("")};class C{constructor(e,t,s,r){S(this,f,void 0);S(this,y,void 0);S(this,w,void 0);S(this,l,void 0);this.id=U(8),R(this,f,e),R(this,y,t),R(this,w,s),R(this,l,r)}interactedBy(e){const t=new Date,s=new z,r=o=>{const d=o.slice(-1)[0];return d.course==="goals"?Promise.resolve(o):i(this,l).next(d).then(g=>(o.push(g),r(o)))};if(i(this,l).authorize&&!i(this,l).authorize(e,i(this,f),i(this,y))){const o=new j(e,i(this,f),i(this,y));return Promise.reject(o)}const h=[i(this,w)];return r(h).then(o=>{const d=new Date,g=d.getTime()-t.getTime(),b=o.slice(-1)[0],m=s.success({id:this.id,actor:e,domain:i(this,f),usecase:i(this,y),startAt:t,endAt:d,elapsedTimeMs:g,performedScenario:o,lastSceneContext:b});return i(this,l).complete&&i(this,l).complete(m),m}).catch(o=>{console.error(o);const d=new Date,g=d.getTime()-t.getTime(),b=h.slice(-1)[0],m=s.failure({id:this.id,actor:e,domain:i(this,f),usecase:i(this,y),startAt:t,endAt:d,elapsedTimeMs:g,performedScenario:h,failedSceneContext:b,error:o});return i(this,l).complete&&i(this,l).complete(m),m})}}f=new WeakMap,y=new WeakMap,w=new WeakMap,l=new WeakMap;const A=class{constructor(e,t,s,r){return new Proxy(this,{get(h,o,d){return typeof o=="string"&&!(o in h)?g=>{const b={scene:o,course:s,...g},m=new r,O=new C(e,t,b,m);return Object.freeze(Object.assign(O,{name:t,domain:e}))}:Reflect.get(h,o,d)}})}};class F{constructor(e,t,s){this.name=t,this.basics=new A(e,t,"basics",s),this.alternatives=new A(e,t,"alternatives",s),this.goals=new A(e,t,"goals",s)}}class N{constructor(){this.basics=new v("basics"),this.alternatives=new v("alternatives"),this.goals=new v("goals")}just(e){return Promise.resolve(e)}}const I=class{constructor(e,t){return new Proxy(this,{get(s,r,h){return typeof r=="string"&&!(r in s)?new F(e,r,t[r]):Reflect.get(s,r,h)}})}},B=class{constructor(e){return new Proxy(this,{get(t,s,r){return typeof s=="string"&&!(s in t)?new I(s,e[s]):Reflect.get(t,s,r)}})}};class j extends Error{constructor(e,t,s){super(`The actor "${e.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(t)}".`)}}n.ActorNotAuthorizedToInteractIn=j,n.BaseActor=c,n.BaseScenario=N,n.InteractResultType=x,n.Nobody=u,n.Robustive=B,n.UsecaseSelector=I,n.isNobody=T,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
