var F=(n,u,h)=>{if(!u.has(n))throw TypeError("Cannot "+h)};var r=(n,u,h)=>(F(n,u,"read from private field"),h?h.call(n):u.get(n)),v=(n,u,h)=>{if(u.has(n))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(n):u.set(n,h)},m=(n,u,h,R)=>(F(n,u,"write to private field"),R?R.call(n,h):u.set(n,h),h);(function(n,u){typeof exports=="object"&&typeof module!="undefined"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(n=typeof globalThis!="undefined"?globalThis:n||self,u(n.Robustive={}))})(this,function(n){var d,g,y,l;"use strict";class u{constructor(e=null){this.user=e}}class h extends u{}const R=a=>a.constructor===h,j=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},O=class{constructor(e){return new Proxy(this,{get(t,s,i){return typeof s=="string"&&!(s in t)?c=>Object.freeze(Object.assign(c||{},{scene:s,course:e})):Reflect.get(t,s,i)}})}},A=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}};class C{constructor(e,t,s,i=!1){this.domain=e,this.usecase=t,this.id=s,this.isSubstitute=i,this.keys={basics:new j,alternatives:new j,goals:new j},this.basics=new O("basics"),this.alternatives=new O("alternatives"),this.goals=new O("goals")}next(e,t){return this.delegate!==void 0&&this.delegate.next!==void 0?this.delegate.next(e,t,this):Promise.reject(new Error)}just(e){return Promise.resolve(e)}authorize(e,t,s){if(this.delegate!==void 0&&this.delegate.authorize!==void 0)return this.delegate.authorize(e,t,s);throw new Error(`USECASE "${s}" IS NOT AUTHORIZED FOR ACTOR "${e.constructor.name}."`)}complete(e){this.delegate!==void 0&&this.delegate.complete!==void 0&&this.delegate.complete(e)}}const E={success:"success",failure:"failure"},N=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?i=>Object.freeze(Object.assign(i,{type:t})):Reflect.get(e,t,s)}})}},U=a=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(a))).map(t=>e[t%e.length]).join("")};class k{constructor(e,t,s,i,c){v(this,d,void 0);v(this,g,void 0);v(this,y,void 0);v(this,l,void 0);this.id=e,m(this,d,t),m(this,g,s),m(this,y,i),m(this,l,c)}set(e){r(this,l).delegate=e}progress(e){if(r(this,l).authorize&&!r(this,l).authorize(e,r(this,d),r(this,g))){const t=new z(e,r(this,d),r(this,g));return Promise.reject(t)}return r(this,l).next(r(this,y),e).then(t=>(m(this,y,t),t))}interactedBy(e){const t=new Date,s=new N,i=o=>{const f=o.slice(-1)[0];return f.course==="goals"?Promise.resolve(o):r(this,l).next(f,e).then(w=>(m(this,y,w),o.push(w),i(o)))};if(r(this,l).authorize&&!r(this,l).authorize(e,r(this,d),r(this,g))){const o=new z(e,r(this,d),r(this,g));return Promise.reject(o)}const c=[r(this,y)];return i(c).then(o=>{const f=new Date,w=f.getTime()-t.getTime(),S=o.slice(-1)[0],b=s.success({id:this.id,actor:e,domain:r(this,d),usecase:r(this,g),startAt:t,endAt:f,elapsedTimeMs:w,performedScenario:o,lastSceneContext:S});return r(this,l).complete&&r(this,l).complete(b),b}).catch(o=>{console.error(o);const f=new Date,w=f.getTime()-t.getTime(),S=c.slice(-1)[0],b=s.failure({id:this.id,actor:e,domain:r(this,d),usecase:r(this,g),startAt:t,endAt:f,elapsedTimeMs:w,performedScenario:c,failedSceneContext:S,error:o});return r(this,l).complete&&r(this,l).complete(b),b})}}d=new WeakMap,g=new WeakMap,y=new WeakMap,l=new WeakMap;const T=class{constructor(e,t,s,i){return new Proxy(this,{get(c,o,f){return typeof o=="string"&&!(o in c)?(w,S,b=!1)=>{const $=Object.assign(w||{},{scene:o,course:s}),I=S||U(8),_=new i(e,t,I,b),B=new k(I,e,t,$,_);return Object.freeze(Object.assign(B,{domain:e,name:t,scene:o,course:s}))}:Reflect.get(c,o,f)}})}};class P{constructor(e,t,s){this.keys={basics:new A,alternatives:new A,goals:new A},this.basics=new T(e,t,"basics",s),this.alternatives=new T(e,t,"alternatives",s),this.goals=new T(e,t,"goals",s)}}const x=class{constructor(e,t){const s=Object.keys(t);return this.keys=s.reduce((i,c)=>(i[c]=c,i),{}),new Proxy(this,{get(i,c,o){return typeof c=="string"&&s.includes(c)?new P(e,c,t[c]):Reflect.get(i,c,o)}})}},D=class{constructor(e){const t=Object.keys(e);return this.keys=t.reduce((s,i)=>(s[i]=i,s),{}),new Proxy(this,{get(s,i,c){return typeof i=="string"&&t.includes(i)?new x(i,e[i]):Reflect.get(s,i,c)}})}};class z extends Error{constructor(e,t,s){super(`The actor "${e.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(t)}".`)}}const K=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},M=class{constructor(e){return this.keys=new K,new Proxy(this,{get(t,s,i){return typeof s=="string"&&!(s in t)?c=>Object.freeze(e!==void 0?Object.assign(new e,Object.assign(c||{},{case:s})):Object.assign(c||{},{case:s})):Reflect.get(t,s,i)}})}};n.AbstractActor=u,n.ActorNotAuthorizedToInteractIn=z,n.CourseSelector=P,n.InteractResultType=E,n.Nobody=h,n.Robustive=D,n.Scenario=C,n.SwiftEnum=M,n.UsecaseSelector=x,n.isNobody=R,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
