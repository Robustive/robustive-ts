var I=(n,i,l)=>{if(!i.has(n))throw TypeError("Cannot "+l)};var a=(n,i,l)=>(I(n,i,"read from private field"),l?l.call(n):i.get(n)),S=(n,i,l)=>{if(i.has(n))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(n):i.set(n,l)},R=(n,i,l,v)=>(I(n,i,"write to private field"),v?v.call(n,l):i.set(n,l),l);(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.Robustive={}))})(this,function(n){var d,f,b,h;"use strict";class i{constructor(e=null){this.user=e}}class l extends i{}const v=u=>u.constructor===l,j=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},T=class{constructor(e){return new Proxy(this,{get(t,s,c){return typeof s=="string"&&!(s in t)?o=>Object.freeze(Object.assign(o||{},{scene:s,course:e})):Reflect.get(t,s,c)}})}},A=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},O={success:"success",failure:"failure"},z=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?c=>Object.freeze(Object.assign(c,{type:t})):Reflect.get(e,t,s)}})}},C=u=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(u))).map(t=>e[t%e.length]).join("")};class N{constructor(e,t,s,c){S(this,d,void 0);S(this,f,void 0);S(this,b,void 0);S(this,h,void 0);this.id=C(8),R(this,d,e),R(this,f,t),R(this,b,s),R(this,h,c)}interactedBy(e){const t=new Date,s=new z,c=r=>{const y=r.slice(-1)[0];return y.course==="goals"?Promise.resolve(r):a(this,h).next(y).then(g=>(r.push(g),c(r)))};if(a(this,h).authorize&&!a(this,h).authorize(e,a(this,d),a(this,f))){const r=new F(e,a(this,d),a(this,f));return Promise.reject(r)}const o=[a(this,b)];return c(o).then(r=>{const y=new Date,g=y.getTime()-t.getTime(),m=r.slice(-1)[0],w=s.success({id:this.id,actor:e,domain:a(this,d),usecase:a(this,f),startAt:t,endAt:y,elapsedTimeMs:g,performedScenario:r,lastSceneContext:m});return a(this,h).complete&&a(this,h).complete(w),w}).catch(r=>{console.error(r);const y=new Date,g=y.getTime()-t.getTime(),m=o.slice(-1)[0],w=s.failure({id:this.id,actor:e,domain:a(this,d),usecase:a(this,f),startAt:t,endAt:y,elapsedTimeMs:g,performedScenario:o,failedSceneContext:m,error:r});return a(this,h).complete&&a(this,h).complete(w),w})}}d=new WeakMap,f=new WeakMap,b=new WeakMap,h=new WeakMap;const x=class{constructor(e,t,s,c){return new Proxy(this,{get(o,r,y){return typeof r=="string"&&!(r in o)?g=>{const m=Object.assign(g||{},{scene:r,course:s}),w=new c(e),M=new N(e,t,m,w);return Object.freeze(Object.assign(M,{domain:e,name:t,scene:r,course:s}))}:Reflect.get(o,r,y)}})}};class B{constructor(e,t,s){this.keys={basics:new A,alternatives:new A,goals:new A},this.basics=new x(e,t,"basics",s),this.alternatives=new x(e,t,"alternatives",s),this.goals=new x(e,t,"goals",s)}}class U{constructor(e){this.domain=e,this.keys={basics:new j,alternatives:new j,goals:new j},this.basics=new T("basics"),this.alternatives=new T("alternatives"),this.goals=new T("goals")}just(e){return Promise.resolve(e)}}const P=class{constructor(e,t){const s=Object.keys(t);return this.keys=s.reduce((c,o)=>(c[o]=o,c),{}),new Proxy(this,{get(c,o,r){return typeof o=="string"&&s.includes(o)?new B(e,o,t[o]):Reflect.get(c,o,r)}})}},k=class{constructor(e){const t=Object.keys(e);return this.keys=t.reduce((s,c)=>(s[c]=c,s),{}),new Proxy(this,{get(s,c,o){return typeof c=="string"&&t.includes(c)?new P(c,e[c]):Reflect.get(s,c,o)}})}};class F extends Error{constructor(e,t,s){super(`The actor "${e.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(t)}".`)}}n.ActorNotAuthorizedToInteractIn=F,n.BaseActor=i,n.BaseScenario=U,n.InteractResultType=O,n.Nobody=l,n.Robustive=k,n.UsecaseSelector=P,n.isNobody=v,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
