var C=(r,u,h)=>{if(!u.has(r))throw TypeError("Cannot "+h)};var c=(r,u,h)=>(C(r,u,"read from private field"),h?h.call(r):u.get(r)),R=(r,u,h)=>{if(u.has(r))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(r):u.set(r,h)},S=(r,u,h,v)=>(C(r,u,"write to private field"),v?v.call(r,h):u.set(r,h),h);(function(r,u){typeof exports=="object"&&typeof module!="undefined"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(r=typeof globalThis!="undefined"?globalThis:r||self,u(r.Robustive={}))})(this,function(r){var f,y,b,l;"use strict";class u{constructor(e=null){this.user=e}}class h extends u{}const v=a=>a.constructor===h,E=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},z=class{constructor(e){return this.keys=new E,new Proxy(this,{get(t,s,n){return typeof s=="string"&&!(s in t)?i=>Object.freeze(e!==void 0?Object.assign(new e,Object.assign(i||{},{case:s})):Object.assign(i||{},{case:s})):Reflect.get(t,s,n)}})}},j=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},O=class{constructor(e){return new Proxy(this,{get(t,s,n){return typeof s=="string"&&!(s in t)?i=>Object.freeze(Object.assign(i||{},{scene:s,course:e})):Reflect.get(t,s,n)}})}},A=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?t:Reflect.get(e,t,s)}})}},I=new z;class N{constructor(e,t,s,n=!1){this.domain=e,this.usecase=t,this.id=s,this.isSubstitute=n,this.keys={basics:new j,alternatives:new j,goals:new j},this.basics=new O("basics"),this.alternatives=new O("alternatives"),this.goals=new O("goals")}next(e,t){return this.delegate!==void 0&&this.delegate.next!==void 0?this.delegate.next(e,t,this):Promise.reject(new Error)}proceedUntilResponse(e,t,s,n){return this.delegate!==void 0&&this.delegate.proceedUntilResponse!==void 0?this.delegate.proceedUntilResponse(e,t,s,n,this):Promise.reject(new Error)}just(e){return Promise.resolve(e)}respond(e,t=I.normal({statusCode:200})){return Promise.resolve({...e,status:t})}authorize(e,t,s){if(this.delegate!==void 0&&this.delegate.authorize!==void 0)return this.delegate.authorize(e,t,s);throw new Error(`USECASE "${s}" IS NOT AUTHORIZED FOR ACTOR "${e.constructor.name}."`)}complete(e){this.delegate!==void 0&&this.delegate.complete!==void 0&&this.delegate.complete(e)}}const k={success:"success",failure:"failure"},D=class{constructor(){return new Proxy(this,{get(e,t,s){return typeof t=="string"&&!(t in e)?n=>Object.freeze(Object.assign(n,{type:t})):Reflect.get(e,t,s)}})}},K=a=>{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(a))).map(t=>e[t%e.length]).join("")};class M{constructor(e,t,s,n,i){R(this,f,void 0);R(this,y,void 0);R(this,b,void 0);R(this,l,void 0);this.id=e,S(this,f,t),S(this,y,s),S(this,b,n),S(this,l,i)}set(e){c(this,l).delegate=e}handleRequest(e,t,s){const n=(o,d,g)=>{const w=g.slice(-1)[0];return w.course==="goals"||w.status?Promise.resolve(w):c(this,l).proceedUntilResponse(o,d,w,s).then(m=>(S(this,b,m),g.push(m),n(o,d,g)))};if(c(this,l).authorize&&!c(this,l).authorize(s,c(this,f),c(this,y))){const o=new T(s,c(this,f),c(this,y));return Promise.reject(o)}const i=[c(this,b)];return n(e,t,i)}interactedBy(e){const t=new Date,s=new D,n=o=>{const d=o.slice(-1)[0];return d.course==="goals"?Promise.resolve(o):c(this,l).next(d,e).then(g=>(S(this,b,g),o.push(g),n(o)))};if(c(this,l).authorize&&!c(this,l).authorize(e,c(this,f),c(this,y))){const o=new T(e,c(this,f),c(this,y));return Promise.reject(o)}const i=[c(this,b)];return n(i).then(o=>{const d=new Date,g=d.getTime()-t.getTime(),w=o.slice(-1)[0],m=s.success({id:this.id,actor:e,domain:c(this,f),usecase:c(this,y),startAt:t,endAt:d,elapsedTimeMs:g,performedScenario:o,lastSceneContext:w});return c(this,l).complete&&c(this,l).complete(m),m}).catch(o=>{console.error(o);const d=new Date,g=d.getTime()-t.getTime(),w=i.slice(-1)[0],m=s.failure({id:this.id,actor:e,domain:c(this,f),usecase:c(this,y),startAt:t,endAt:d,elapsedTimeMs:g,performedScenario:i,failedSceneContext:w,error:o});return c(this,l).complete&&c(this,l).complete(m),m})}}f=new WeakMap,y=new WeakMap,b=new WeakMap,l=new WeakMap;const P=class{constructor(e,t,s,n){return new Proxy(this,{get(i,o,d){return typeof o=="string"&&!(o in i)?(g,w,m=!1)=>{const _=Object.assign(g||{},{scene:o,course:s}),U=w||K(8),B=new n(e,t,U,m),H=new M(U,e,t,_,B);return Object.freeze(Object.assign(H,{domain:e,name:t,scene:o,course:s}))}:Reflect.get(i,o,d)}})}};class F{constructor(e,t,s){this.keys={basics:new A,alternatives:new A,goals:new A},this.basics=new P(e,t,"basics",s),this.alternatives=new P(e,t,"alternatives",s),this.goals=new P(e,t,"goals",s)}}const x=class{constructor(e,t){const s=Object.keys(t);return this.keys=s.reduce((n,i)=>(n[i]=i,n),{}),new Proxy(this,{get(n,i,o){return typeof i=="string"&&s.includes(i)?new F(e,i,t[i]):Reflect.get(n,i,o)}})}},$=class{constructor(e){const t=Object.keys(e);return this.keys=t.reduce((s,n)=>(s[n]=n,s),{}),new Proxy(this,{get(s,n,i){return typeof n=="string"&&t.includes(n)?new x(n,e[n]):Reflect.get(s,n,i)}})}};class T extends Error{constructor(e,t,s){super(`The actor "${e.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(t)}".`)}}r.AbstractActor=u,r.ActorNotAuthorizedToInteractIn=T,r.CourseSelector=F,r.InteractResultType=k,r.Nobody=h,r.ResponseStatus=I,r.Robustive=$,r.Scenario=N,r.SwiftEnum=z,r.UsecaseSelector=x,r.isNobody=v,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
