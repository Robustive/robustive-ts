var I=(n,a,h)=>{if(!a.has(n))throw TypeError("Cannot "+h)};var i=(n,a,h)=>(I(n,a,"read from private field"),h?h.call(n):a.get(n)),S=(n,a,h)=>{if(a.has(n))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(n):a.set(n,h)},R=(n,a,h,j)=>(I(n,a,"write to private field"),j?j.call(n,h):a.set(n,h),h);(function(n,a){typeof exports=="object"&&typeof module!="undefined"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(n=typeof globalThis!="undefined"?globalThis:n||self,a(n.Robustive={}))})(this,function(n){var d,y,b,l;"use strict";class a{constructor(t=null){this.user=t}}class h extends a{}const j=u=>u.constructor===h,v=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},T=class{constructor(t){return new Proxy(this,{get(e,s,c){return typeof s=="string"&&!(s in e)?r=>Object.freeze(Object.assign(r||{},{scene:s,course:t})):Reflect.get(e,s,c)}})}},x=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},O={success:"success",failure:"failure"},C=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?c=>Object.freeze(Object.assign(c,{type:e})):Reflect.get(t,e,s)}})}},N=u=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(u))).map(e=>t[e%t.length]).join("")};class B{constructor(t,e,s,c,r){S(this,d,void 0);S(this,y,void 0);S(this,b,void 0);S(this,l,void 0);this.id=t,R(this,d,e),R(this,y,s),R(this,b,c),R(this,l,r)}progress(t){if(i(this,l).authorize&&!i(this,l).authorize(t,i(this,d),i(this,y))){const e=new P(t,i(this,d),i(this,y));return Promise.reject(e)}return i(this,l).next(i(this,b))}interactedBy(t){const e=new Date,s=new C,c=o=>{const f=o.slice(-1)[0];return f.course==="goals"?Promise.resolve(o):i(this,l).next(f).then(g=>(o.push(g),c(o)))};if(i(this,l).authorize&&!i(this,l).authorize(t,i(this,d),i(this,y))){const o=new P(t,i(this,d),i(this,y));return Promise.reject(o)}const r=[i(this,b)];return c(r).then(o=>{const f=new Date,g=f.getTime()-e.getTime(),m=o.slice(-1)[0],w=s.success({id:this.id,actor:t,domain:i(this,d),usecase:i(this,y),startAt:e,endAt:f,elapsedTimeMs:g,performedScenario:o,lastSceneContext:m});return i(this,l).complete&&i(this,l).complete(w),w}).catch(o=>{console.error(o);const f=new Date,g=f.getTime()-e.getTime(),m=r.slice(-1)[0],w=s.failure({id:this.id,actor:t,domain:i(this,d),usecase:i(this,y),startAt:e,endAt:f,elapsedTimeMs:g,performedScenario:r,failedSceneContext:m,error:o});return i(this,l).complete&&i(this,l).complete(w),w})}}d=new WeakMap,y=new WeakMap,b=new WeakMap,l=new WeakMap;const A=class{constructor(t,e,s,c){return new Proxy(this,{get(r,o,f){return typeof o=="string"&&!(o in r)?(g,m,w=!1)=>{const D=Object.assign(g||{},{scene:o,course:s}),F=m||N(8),_=new c(t,e,F,w),K=new B(F,t,e,D,_);return Object.freeze(Object.assign(K,{domain:t,name:e,scene:o,course:s}))}:Reflect.get(r,o,f)}})}};class U{constructor(t,e,s){this.keys={basics:new x,alternatives:new x,goals:new x},this.basics=new A(t,e,"basics",s),this.alternatives=new A(t,e,"alternatives",s),this.goals=new A(t,e,"goals",s)}}class k{constructor(t,e,s,c=!1){this.domain=t,this.usecase=e,this.id=s,this.isSubstitute=c,this.keys={basics:new v,alternatives:new v,goals:new v},this.basics=new T("basics"),this.alternatives=new T("alternatives"),this.goals=new T("goals")}just(t){return Promise.resolve(t)}}const z=class{constructor(t,e){const s=Object.keys(e);return this.keys=s.reduce((c,r)=>(c[r]=r,c),{}),new Proxy(this,{get(c,r,o){return typeof r=="string"&&s.includes(r)?new U(t,r,e[r]):Reflect.get(c,r,o)}})}},M=class{constructor(t){const e=Object.keys(t);return this.keys=e.reduce((s,c)=>(s[c]=c,s),{}),new Proxy(this,{get(s,c,r){return typeof c=="string"&&e.includes(c)?new z(c,t[c]):Reflect.get(s,c,r)}})}};class P extends Error{constructor(t,e,s){super(`The actor "${t.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(e)}".`)}}n.ActorNotAuthorizedToInteractIn=P,n.BaseActor=a,n.BaseScenario=k,n.InteractResultType=O,n.Nobody=h,n.Robustive=M,n.UsecaseSelector=z,n.isNobody=j,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
