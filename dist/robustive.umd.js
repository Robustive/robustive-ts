var I=(n,r,u)=>{if(!r.has(n))throw TypeError("Cannot "+u)};var o=(n,r,u)=>(I(n,r,"read from private field"),u?u.call(n):r.get(n)),S=(n,r,u)=>{if(r.has(n))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(n):r.set(n,u)},R=(n,r,u,v)=>(I(n,r,"write to private field"),v?v.call(n,u):r.set(n,u),u);(function(n,r){typeof exports=="object"&&typeof module!="undefined"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(n=typeof globalThis!="undefined"?globalThis:n||self,r(n.Robustive={}))})(this,function(n){var d,f,b,l;"use strict";class r{constructor(t=null){this.user=t}}class u extends r{}const v=a=>a.constructor===u,T=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},A=class{constructor(t){return new Proxy(this,{get(e,s,c){return typeof s=="string"&&!(s in e)?h=>Object.freeze({scene:s,course:t,...h}):Reflect.get(e,s,c)}})}},x=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},z={success:"success",failure:"failure"},C=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?c=>Object.freeze({type:e,...c}):Reflect.get(t,e,s)}})}},O=a=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(a))).map(e=>t[e%t.length]).join("")};class N{constructor(t,e,s,c){S(this,d,void 0);S(this,f,void 0);S(this,b,void 0);S(this,l,void 0);this.id=O(8),R(this,d,t),R(this,f,e),R(this,b,s),R(this,l,c)}interactedBy(t){const e=new Date,s=new C,c=i=>{const y=i.slice(-1)[0];return y.course==="goals"?Promise.resolve(i):o(this,l).next(y).then(g=>(i.push(g),c(i)))};if(o(this,l).authorize&&!o(this,l).authorize(t,o(this,d),o(this,f))){const i=new F(t,o(this,d),o(this,f));return Promise.reject(i)}const h=[o(this,b)];return c(h).then(i=>{const y=new Date,g=y.getTime()-e.getTime(),m=i.slice(-1)[0],w=s.success({id:this.id,actor:t,domain:o(this,d),usecase:o(this,f),startAt:e,endAt:y,elapsedTimeMs:g,performedScenario:i,lastSceneContext:m});return o(this,l).complete&&o(this,l).complete(w),w}).catch(i=>{console.error(i);const y=new Date,g=y.getTime()-e.getTime(),m=h.slice(-1)[0],w=s.failure({id:this.id,actor:t,domain:o(this,d),usecase:o(this,f),startAt:e,endAt:y,elapsedTimeMs:g,performedScenario:h,failedSceneContext:m,error:i});return o(this,l).complete&&o(this,l).complete(w),w})}}d=new WeakMap,f=new WeakMap,b=new WeakMap,l=new WeakMap;const j=class{constructor(t,e,s,c){return new Proxy(this,{get(h,i,y){return typeof i=="string"&&!(i in h)?g=>{const m={scene:i,course:s,...g},w=new c,M=new N(t,e,m,w);return Object.freeze(Object.assign(M,{name:e,domain:t}))}:Reflect.get(h,i,y)}})}};class B{constructor(t,e,s){this.keys={basics:new x,alternatives:new x,goals:new x},this.basics=new j(t,e,"basics",s),this.alternatives=new j(t,e,"alternatives",s),this.goals=new j(t,e,"goals",s)}}class U{constructor(){this.keys={basics:new T,alternatives:new T,goals:new T},this.basics=new A("basics"),this.alternatives=new A("alternatives"),this.goals=new A("goals")}just(t){return Promise.resolve(t)}}const P=class{constructor(t,e){return this.keys=Object.keys(e).reduce((s,c)=>(s[c]=c,s),{}),new Proxy(this,{get(s,c,h){return typeof c=="string"&&!(c in s)?new B(t,c,e[c]):Reflect.get(s,c,h)}})}},k=class{constructor(t){return this.keys=Object.keys(t).reduce((e,s)=>(e[s]=s,e),{}),new Proxy(this,{get(e,s,c){return typeof s=="string"&&!(s in e)?new P(s,t[s]):Reflect.get(e,s,c)}})}};class F extends Error{constructor(t,e,s){super(`The actor "${t.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(e)}".`)}}n.ActorNotAuthorizedToInteractIn=F,n.BaseActor=r,n.BaseScenario=U,n.InteractResultType=z,n.Nobody=u,n.Robustive=k,n.UsecaseSelector=P,n.isNobody=v,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
