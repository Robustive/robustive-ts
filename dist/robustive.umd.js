var I=(n,i,l)=>{if(!i.has(n))throw TypeError("Cannot "+l)};var a=(n,i,l)=>(I(n,i,"read from private field"),l?l.call(n):i.get(n)),S=(n,i,l)=>{if(i.has(n))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(n):i.set(n,l)},R=(n,i,l,v)=>(I(n,i,"write to private field"),v?v.call(n,l):i.set(n,l),l);(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.Robustive={}))})(this,function(n){var d,f,b,h;"use strict";class i{constructor(t=null){this.user=t}}class l extends i{}const v=u=>u.constructor===l,T=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},A=class{constructor(t){return new Proxy(this,{get(e,s,c){return typeof s=="string"&&!(s in e)?o=>Object.freeze({scene:s,course:t,...o}):Reflect.get(e,s,c)}})}},x=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},z={success:"success",failure:"failure"},C=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?c=>Object.freeze({type:e,...c}):Reflect.get(t,e,s)}})}},O=u=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(u))).map(e=>t[e%t.length]).join("")};class N{constructor(t,e,s,c){S(this,d,void 0);S(this,f,void 0);S(this,b,void 0);S(this,h,void 0);this.id=O(8),R(this,d,t),R(this,f,e),R(this,b,s),R(this,h,c)}interactedBy(t){const e=new Date,s=new C,c=r=>{const y=r.slice(-1)[0];return y.course==="goals"?Promise.resolve(r):a(this,h).next(y).then(g=>(r.push(g),c(r)))};if(a(this,h).authorize&&!a(this,h).authorize(t,a(this,d),a(this,f))){const r=new F(t,a(this,d),a(this,f));return Promise.reject(r)}const o=[a(this,b)];return c(o).then(r=>{const y=new Date,g=y.getTime()-e.getTime(),m=r.slice(-1)[0],w=s.success({id:this.id,actor:t,domain:a(this,d),usecase:a(this,f),startAt:e,endAt:y,elapsedTimeMs:g,performedScenario:r,lastSceneContext:m});return a(this,h).complete&&a(this,h).complete(w),w}).catch(r=>{console.error(r);const y=new Date,g=y.getTime()-e.getTime(),m=o.slice(-1)[0],w=s.failure({id:this.id,actor:t,domain:a(this,d),usecase:a(this,f),startAt:e,endAt:y,elapsedTimeMs:g,performedScenario:o,failedSceneContext:m,error:r});return a(this,h).complete&&a(this,h).complete(w),w})}}d=new WeakMap,f=new WeakMap,b=new WeakMap,h=new WeakMap;const j=class{constructor(t,e,s,c){return new Proxy(this,{get(o,r,y){return typeof r=="string"&&!(r in o)?g=>{const m={scene:r,course:s,...g},w=new c,M=new N(t,e,m,w);return Object.freeze(Object.assign(M,{domain:t,name:e,scene:r,course:s}))}:Reflect.get(o,r,y)}})}};class B{constructor(t,e,s){this.keys={basics:new x,alternatives:new x,goals:new x},this.basics=new j(t,e,"basics",s),this.alternatives=new j(t,e,"alternatives",s),this.goals=new j(t,e,"goals",s)}}class U{constructor(){this.keys={basics:new T,alternatives:new T,goals:new T},this.basics=new A("basics"),this.alternatives=new A("alternatives"),this.goals=new A("goals")}just(t){return Promise.resolve(t)}}const P=class{constructor(t,e){const s=Object.keys(e);return this.keys=s.reduce((c,o)=>(c[o]=o,c),{}),new Proxy(this,{get(c,o,r){return typeof o=="string"&&s.includes(o)?new B(t,o,e[o]):Reflect.get(c,o,r)}})}},k=class{constructor(t){const e=Object.keys(t);return this.keys=e.reduce((s,c)=>(s[c]=c,s),{}),new Proxy(this,{get(s,c,o){return typeof c=="string"&&e.includes(c)?new P(c,t[c]):Reflect.get(s,c,o)}})}};class F extends Error{constructor(t,e,s){super(`The actor "${t.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(e)}".`)}}n.ActorNotAuthorizedToInteractIn=F,n.BaseActor=i,n.BaseScenario=U,n.InteractResultType=z,n.Nobody=l,n.Robustive=k,n.UsecaseSelector=P,n.isNobody=v,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
