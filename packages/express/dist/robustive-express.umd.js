(function(i,o){typeof exports=="object"&&typeof module!="undefined"?o(exports,require("@robustive/robustive-ts")):typeof define=="function"&&define.amd?define(["exports","@robustive/robustive-ts"],o):(i=typeof globalThis!="undefined"?globalThis:i||self,o(i.RobustiveExpress={},i.Robustive))})(this,function(i,o){"use strict";const f=new o.SwiftEnum;class m extends Error{constructor(r,t,a){super(`"${a}" is not authorized to proceed usecase "${String(t)}" of domain "${String(r)}".`),this.name="HttpMethodIsNotAuthorized"}}o.Scenario.prototype.validateHttpMethod=function(n,r,t){return this.delegate!==void 0&&this.delegate.validateHttpMethod!==void 0?this.delegate.validateHttpMethod(n,r,t):!0},o.Scenario.prototype.proceedUntilResponse=function(n,r,t,a){return this.delegate!==void 0&&this.delegate.proceedUntilResponse!==void 0?this.delegate.proceedUntilResponse(n,r,t,a,this):Promise.reject(new Error)},o.Scenario.prototype.respond=function(n,r=f.normal({statusCode:200})){return Promise.resolve({...n,status:r})};const p={success:"success",failure:"failure"};o.UsecaseImple.prototype.handleRequest=function(n,r,t,a){const e=this,l=new Date,_=(s,d,u)=>{const c=u.slice(-1)[0];return c.course==="goals"||c.status?Promise.resolve(u):e._scenario.proceedUntilResponse(s,d,c,t).then(v=>(e.currentContext=v,u.push(v),_(s,d,u)))};if(e._scenario.authorize&&!e._scenario.authorize(t,e._domain,e._usecase)){const s=new o.ActorNotAuthorizedToInteractIn(t,e._domain,e._usecase);return Promise.reject(s)}if(e._scenario.validateHttpMethod&&!e._scenario.validateHttpMethod(e._domain,e._usecase,n.method)){const s=new m(e._domain,e._usecase,n.method);return Promise.reject(s)}const h=[e.currentContext],g=()=>_(n,r,h).then(s=>{const d=new Date,u=d.getTime()-l.getTime(),c=s.slice(-1)[0];return{type:p.success,id:e.id,actor:t,domain:e._domain,usecase:e._usecase,startAt:l,endAt:d,elapsedTimeMs:u,performedScenario:s,lastSceneContext:c}}).catch(s=>{const d=new Date,u=d.getTime()-l.getTime(),c=h.slice(-1)[0];return{type:p.failure,id:e.id,actor:t,domain:e._domain,usecase:e._usecase,startAt:l,endAt:d,elapsedTimeMs:u,performedScenario:h,failedSceneContext:c,error:s}});return a?a(g):g()},i.HandleResultType=p,i.HttpMethodIsNotAuthorized=m,i.ResponseStatus=f,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=robustive-express.umd.js.map
