(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("@robustive/robustive-ts")):typeof define=="function"&&define.amd?define(["exports","@robustive/robustive-ts"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n.RobustiveExpress={},n.Robustive))})(this,function(n,t){"use strict";const m=new t.SwiftEnum;t.Scenario.prototype.proceedUntilResponse=function(c,d,r,a){return this.delegate!==void 0&&this.delegate.proceedUntilResponse!==void 0?this.delegate.proceedUntilResponse(c,d,r,a,this):Promise.reject(new Error)},t.Scenario.prototype.respond=function(c,d=m.normal({statusCode:200})){return Promise.resolve({...c,status:d})};const p={success:"success",failure:"failure"};t.UsecaseImple.prototype.handleRequest=function(c,d,r,a){const e=this,l=new Date,h=(s,o,i)=>{const u=i.slice(-1)[0];return u.course==="goals"||u.status?Promise.resolve(i):e._scenario.proceedUntilResponse(s,o,u,r).then(R=>(e.currentContext=R,i.push(R),h(s,o,i)))};if(e._scenario.authorize&&!e._scenario.authorize(r,e._domain,e._usecase)){const s=new t.ActorNotAuthorizedToInteractIn(r,e._domain,e._usecase);return Promise.reject(s)}const f=[e.currentContext],_=()=>h(c,d,f).then(s=>{const o=new Date,i=o.getTime()-l.getTime(),u=s.slice(-1)[0];return{type:p.success,id:e.id,actor:r,domain:e._domain,usecase:e._usecase,startAt:l,endAt:o,elapsedTimeMs:i,performedScenario:s,lastSceneContext:u}}).catch(s=>{const o=new Date,i=o.getTime()-l.getTime(),u=f.slice(-1)[0];return{type:p.failure,id:e.id,actor:r,domain:e._domain,usecase:e._usecase,startAt:l,endAt:o,elapsedTimeMs:i,performedScenario:f,failedSceneContext:u,error:s}});return a?a(_):_()},n.HandleResultType=p,n.ResponseStatus=m,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=robustive-express.umd.js.map
