(function(o,h){typeof exports=="object"&&typeof module!="undefined"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(o=typeof globalThis!="undefined"?globalThis:o||self,h(o.Robustive={}))})(this,function(o){"use strict";class h{constructor(t=null){this.user=t}}class m extends h{}const j=r=>r.constructor===m,g=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},y=class{constructor(t){return new Proxy(this,{get(e,s,n){return typeof s=="string"&&!(s in e)?c=>Object.freeze(Object.assign(c||{},{scene:s,course:t})):Reflect.get(e,s,n)}})}},f=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}};class O{constructor(t,e,s,n=!1){this.domain=t,this.usecase=e,this.id=s,this.isSubstitute=n,this.keys={basics:new g,alternatives:new g,goals:new g},this.basics=new y("basics"),this.alternatives=new y("alternatives"),this.goals=new y("goals")}next(t,e){return this.delegate!==void 0&&this.delegate.next!==void 0?this.delegate.next(t,e,this):Promise.reject(new Error)}authorize(t,e,s){if(this.delegate!==void 0&&this.delegate.authorize!==void 0)return this.delegate.authorize(t,e,s);throw new Error(`USECASE "${s}" IS NOT AUTHORIZED FOR ACTOR "${t.constructor.name}."`)}complete(t){this.delegate!==void 0&&this.delegate.complete!==void 0&&this.delegate.complete(t)}}const A={success:"success",failure:"failure"},T=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?n=>Object.freeze(Object.assign(n,{type:e})):Reflect.get(t,e,s)}})}},x=r=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(r))).map(e=>t[e%t.length]).join("")};class b{constructor(t,e,s,n,c){this.id=t,this._domain=e,this._usecase=s,this._currentContext=n,this._scenario=c}set(t){this._scenario.delegate=t}interactedBy(t){const e=new Date,s=new T,n=i=>{const a=i.slice(-1)[0];return a.course==="goals"?Promise.resolve(i):this._scenario.next(a,t).then(u=>(this._currentContext=u,i.push(u),n(i)))};if(this._scenario.authorize&&!this._scenario.authorize(t,this._domain,this._usecase)){const i=new R(t,this._domain,this._usecase);return Promise.reject(i)}const c=[this._currentContext];return n(c).then(i=>{const a=new Date,u=a.getTime()-e.getTime(),d=i.slice(-1)[0],l=s.success({id:this.id,actor:t,domain:this._domain,usecase:this._usecase,startAt:e,endAt:a,elapsedTimeMs:u,performedScenario:i,lastSceneContext:d});return this._scenario.complete&&this._scenario.complete(l),l}).catch(i=>{console.error(i);const a=new Date,u=a.getTime()-e.getTime(),d=c.slice(-1)[0],l=s.failure({id:this.id,actor:t,domain:this._domain,usecase:this._usecase,startAt:e,endAt:a,elapsedTimeMs:u,performedScenario:c,failedSceneContext:d,error:i});return this._scenario.complete&&this._scenario.complete(l),l})}}const w=class{constructor(t,e,s,n){return new Proxy(this,{get(c,i,a){return typeof i=="string"&&!(i in c)?(u,d,l=!1)=>{const P=Object.assign(u||{},{scene:i,course:s}),v=d||x(8),C=new n(t,e,v,l),E=new b(v,t,e,P,C);return Object.freeze(Object.assign(E,{domain:t,name:e,scene:i,course:s}))}:Reflect.get(c,i,a)}})}};class S{constructor(t,e,s){this.keys={basics:new f,alternatives:new f,goals:new f},this.basics=new w(t,e,"basics",s),this.alternatives=new w(t,e,"alternatives",s),this.goals=new w(t,e,"goals",s)}}const _=class{constructor(t,e){const s=Object.keys(e);return this.keys=s.reduce((n,c)=>(n[c]=c,n),{}),new Proxy(this,{get(n,c,i){return typeof c=="string"&&s.includes(c)?new S(t,c,e[c]):Reflect.get(n,c,i)}})}},I=class{constructor(t){const e=Object.keys(t);return this.keys=e.reduce((s,n)=>(s[n]=n,s),{}),new Proxy(this,{get(s,n,c){return typeof n=="string"&&e.includes(n)?new _(n,t[n]):Reflect.get(s,n,c)}})}};class R extends Error{constructor(t,e,s){super(`The actor "${t.constructor.name}" is not authorized to interact on usecase "${String(s)}" of domain "${String(e)}".`)}}const z=class{constructor(){return new Proxy(this,{get(t,e,s){return typeof e=="string"&&!(e in t)?e:Reflect.get(t,e,s)}})}},F=class{constructor(t){return this.keys=new z,new Proxy(this,{get(e,s,n){return typeof s=="string"&&!(s in e)?c=>Object.freeze(t!==void 0?Object.assign(new t,Object.assign(c||{},{case:s})):Object.assign(c||{},{case:s})):Reflect.get(e,s,n)}})}};o.AbstractActor=h,o.ActorNotAuthorizedToInteractIn=R,o.CourseSelector=S,o.InteractResultType=A,o.Nobody=m,o.Robustive=I,o.Scenario=O,o.SwiftEnum=F,o.UsecaseImple=b,o.UsecaseSelector=_,o.isNobody=j,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
